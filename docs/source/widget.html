<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Widgets-nlFokkezbForm-controllers-widget'>/**
</span> * Main controller of the widget
 *
 *     @example
 *     Alloy.createWidget(&#39;nl.fokkezb.form&#39;, {
 *       fieldsets: [{
 *         legend: L(&#39;form_common_general&#39;),
 *         fields: [{
 *           name: &#39;code&#39;,
 *           label: L(&#39;form_common_code&#39;),
 *           type: &#39;text&#39;
 *         }, {
 *           name: &#39;employeeNumber&#39;,
 *           label: L(&#39;form_resource_employeeNumber&#39;),
 *           type: &#39;text&#39;
 *         }, {
 *           name: &#39;firstNames&#39;,
 *           label: L(&#39;form_resource_firstNames&#39;),
 *           type: &#39;text&#39;
 *         }, {
 *           name: &#39;lastName&#39;,
 *           label: L(&#39;form_resource_lastName&#39;),
 *           type: &#39;text&#39;
 *         }]
 *       }]
 *     });
 *
 * @class Widgets.nlFokkezbForm.controllers.widget
 */

$.getValues = getValues;
$.setValues = setValues;

<span id='Widgets-nlFokkezbForm-controllers-widget-property-fieldCtrls'>/**
</span> * @type {Object} References to all field controllers by name.
 * @private
 */
var fieldCtrls = {};

<span id='Widgets-nlFokkezbForm-controllers-widget-method-Controller'>/**
</span> * Constructor for the form.
 *
 * Automatically calls #init if it has `args.fieldsets` or `args.fields`.
 *
 * @constructor
 * @method Controller
 * @param args Arguments passed to the controller.
 * @param {String} [args.config] Path of a CommonJS or JSON file to extend `args` with.
 */
(function constructor(args) {

  if (args.config) {

    if (args.config.indexOf(&#39;.json&#39;)) {
      _.extend(args, JSON.parse(Ti.Filesystem.getFile(args.config).read().text));

    } else {
      _.extend(args, require(args.config));
    }
  }

  // these are required, but we
  if (args.fieldsets || args.fields) {
    init(args);
    return;
  }

})(arguments[0] || {});

<span id='Widgets-nlFokkezbForm-controllers-widget-method-init'>/**
</span> * Initialize the form.
 *
 * Called automatically by #Controller if it has `args.fieldsets` or `args.fields`.
 *
 * @param opts Options. Either `opts.fieldsets` or `opts.fields` is required.
 * @param {Object[]} [opts.fieldsets] Array of fieldsets.
 * @param {Object[]} [opts.fields] Array of fields.
 * @param {Object} [opts.values] Values as object with field names as keys.
 * @throws {Error} If the required options are missing.
 */
function init(opts) {
  var fieldsets, values;

  if (!opts.fieldsets &amp;&amp; !opts.fields) {
    throw &#39;Either `opts.fieldsets` or `opts.fields` is required.&#39;;
  }

  // user can either pass an array or fieldsets or just fields we&#39;ll wrap in one
  fieldsets = opts.fieldsets || [{
    fields: opts.fields
  }];

  // values for the fields
  values = opts.values || {};

  render(fieldsets, values);
}

<span id='Widgets-nlFokkezbForm-controllers-widget-method-getValues'>/**
</span> * Get all field values.
 *
 * @return {Object} Values as object with field names as keys.
 */
function getValues() {

  var values = {};

  _.each(fieldCtrls, function(fieldCtrl, name) {
    values[name] = fieldCtrl.getValue();
  });

  return values;
}

<span id='Widgets-nlFokkezbForm-controllers-widget-method-setValues'>/**
</span> * Set field values.
 *
 * @param {Object} Values as object with field names as keys.
 */
function setValues(values) {

  _.each(values, function(value, name) {
    fieldCtrls[name].setValue(value);
  });
}

<span id='Widgets-nlFokkezbForm-controllers-widget-method-render'>/**
</span> * Renders the form.
 *
 * @private
 * @param  {Object[]} fieldsets  Array of fieldset Objects
 * @param  {Object} values       Object containing values
 */
function render(fieldsets, values) {

  // keeps a section for each fieldset
  var sections = [];

  // for each fieldset
  _.each(fieldsets, function(fieldset) {

    // user can pass custom section args
    var sectionArgs = fieldset.section || {};

    // keeps a row for each field
    sectionArgs.rows = sectionArgs.rows || [];

    // user can pass legend we&#39;ll use as headerTitle
    if (fieldset.legend) {
      sectionArgs.headerTitle = fieldset.legend;
    }

    // for each field
    _.each(fieldset.fields, function(field) {

      // user can either pass value in field or in separate &#39;values&#39; arg
      if (values[field.name]) {
        field.value = values[field.name];
      }

      var fieldCtrl;

      // user can specify a controller to deliver the row
      if (field.controller) {
        fieldCtrl = Alloy.createController(field.controller, field);

      } else {

        // user can specify a widget and or widget view (type) to deliver the row
        fieldCtrl = Alloy.createWidget(field.widget || &#39;nl.fokkezb.form&#39;, field.type || &#39;text&#39;, field);
      }

      // keep a reference to the widget
      fieldCtrls[field.name] = fieldCtrl;

      // push the views of the controller as row
      sectionArgs.rows.push(fieldCtrl.getViewEx({

        // makes sure we get an actual view and not the row controller
        recurse: true
      }));

    });

    // create the section, extending TSS style by args
    var section = $.UI.create(&#39;TableViewSection&#39;, sectionArgs);

    // push the section
    sections.push(section);

  });

  // set the table
  $.table.data = sections;
}

function onTableClick(e) {

  var name = _.keys(fieldCtrls)[e.index];

  fieldCtrls[name].focus();
}</pre>
</body>
</html>
